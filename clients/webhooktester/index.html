<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Webhook Tester</title>
</head>
<body>
  <div id="concierge-widget" style="max-width:480px;margin:24px auto;padding:16px;border:1px solid #ddd;border-radius:12px;font-family:system-ui,Arial;">
    <div style="font-weight:600;margin-bottom:8px;">Test Webhook</div>
    <div style="display:flex;gap:8px;">
      <input id="concierge-q" type="text" placeholder="Ihre Frage ..." style="flex:1;padding:10px;border:1px solid #bbb;border-radius:8px" />
      <button id="concierge-send" style="padding:10px 14px;border:0;border-radius:8px;background:#111;color:#fff;cursor:pointer">Senden</button>
    </div>
    <pre id="concierge-out" style="white-space:pre-wrap;margin-top:12px;background:#f8f8f8;padding:12px;border-radius:8px;min-height:48px"></pre>
  </div>

  <script>
    (function () {
      const WEBHOOK = 'https://automation.eudemonia-coaching.de/webhook-test/89486b16-646d-48d0-bfb0-e72f726f38d4';
      const $q   = document.getElementById('concierge-q');
      const $btn = document.getElementById('concierge-send');
      const $out = document.getElementById('concierge-out');

      async function sendConcierge(question) {
        const payload = {
          question: String(question || '').trim(),
          url: window.location.href,
          source: 'tester'
        };
        if (!payload.question) {
          $out.textContent = 'Bitte geben Sie eine Frage ein.';
          return;
        }

        $btn.disabled = true;
        const oldText = $btn.textContent;
        $btn.textContent = 'Senden â€¦';

        try {
          const res = await fetch(WEBHOOK, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            referrerPolicy: 'no-referrer-when-downgrade',
            body: JSON.stringify(payload)
          });

          const raw = await res.text();
          let output;
          try { output = JSON.parse(raw); } catch { output = { output: raw }; }

          const text =
            output.output ||
            output.message ||
            output.text ||
            (output.choices && output.choices[0] && (output.choices[0].message?.content || output.choices[0].text)) ||
            raw;

          $out.textContent = String(text || '').trim() || '(Keine Antwort erhalten)';
        } catch (err) {
          $out.textContent = 'Fehler beim Senden: ' + (err?.message || String(err));
        } finally {
          $btn.disabled = false;
          $btn.textContent = oldText;
        }
      }

      $btn.addEventListener('click', () => sendConcierge($q.value));
      $q.addEventListener('keydown', (e) => { if (e.key === 'Enter') sendConcierge($q.value); });
    })();
  </script>
</body>
</html>
